{% extends 'layout.twig' %}

{% block body %}
  <main class="home container">
    <h1 class="home__title">{{ config.title }}</h1>
    <p class="home__description">{{ config.description }}</p>
    <input id="search" type="text" placeholder="Search any app you would like to detox from">
    <ol class="help">
      <li class="help__step">Connect to this website with your mobile phone</li>
      <li class="help__step">Use the search bar above to find the app you want to detox from</li>
      <li class="help__step">Use the PWA feature of your phone to install the website in your phone</li>
      <li class="help__step">If you are brave enough, uninstall the app you want to detox from</li>
    </ol>
  </main>
{% endblock %}

{% block script %}
  <script src="/javascripts/auto-complete.js"></script>
  <script>
    var startLoading = function () {
      console.log('start loading');
    }

    var stopLoading = function () {
      console.log('stop loading');
    }

    var autocomplete = new autoComplete({
      selector: "#search",
      minChars: 3,
      delay: 150,
      cache: true,
      source: function (term, suggest){
        startLoading();
        fetch('/api/search?q=' + term)
          .then(function(response) {
            return response.json();
          })
          .then(function(myJson) {
            suggest(myJson);
            stopLoading();
          });
      },
      renderItem: function (item, search){
        return `<div class="autocomplete-suggestion" data-appid="${item.appId}"><img src="${item.icon}" class="autocomplete-suggestion__icon">${item.title}</div>`;
      },
      onSelect(event, term, item) {
        window.location.href = '/pwa/' + item.dataset.appid;
      }
    });
  </script>
{% endblock %}
